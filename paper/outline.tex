\documentclass[12pt]{article}
\usepackage{url}
\usepackage[authoryear,round]{natbib}

\title{Outline flowCore paper}

\author{Florian Hahne*\\
  Nolwenn LeMeur*\\
  Byron Ellis\\
  Ryan Brinkman\\
  Perry Haaland\\
  Errol Strain\\
  Deepayan Sarkar\\
  Josef Spidlen\\
  Robert Gentleman
 }

\begin{document}
\maketitle

\vspace{2ex} 

The paper will deal with the capabilities offered by flowCore for
handling flow cytometry data in R. The main focus should be on
high-throughput and how our infrastructure can be used to deal with
such data. We don't want to write a user manual but rather highlight
the problems that arise from high throughput flow applications and the
solutions we offer. A strong point should be on integration of our
infrastructure in the flow world. flowCore is intended to be a
development platform for other scientists, we don't want to provide
full-fledged solutions but rather tools for others to devise such
solutions.

It would be nice to show these things on one data set in the form of a
use case, but that is open to discussion. The problem with such an
approach is that it often looks like a software manual which is not
what we should be aiming for. 

\bigskip
The author list is also still up for discussion, listed here are all
the names that came up during the last telephone conference. NLM and
FH are supposed to share first authorship.

\bigskip
Target journal should be Cytometry, and there are two flavors:
Cytometry A deals with more general topics while Cytometry B is more
geared towards clinical applications. Florian suggests Cytometry A,
here is a link to the author instructions:
\url{http://www3.interscience.wiley.com/journal/33945/home/ForAuthors.html}.
They require the standard Materials and Methods, Results and
Discussion structure which might not be suited for our needs. FH
hasn't found out about alternative methods-type articles yet.  

{\bf NLM:} We can suggest to the editor new format for software/methods
oriented paper?

{\bf RB:} I know the editor and would be happy to speak to him
regarding methods-type articles or other issues if needed.

Also it is not clear from their web page whether they support LaTeX
manuscript submissions but FH would strongly argue for using
LaTeX. They do accept pdf submission.

{\bf RB:} Cytometry does not accept LaTeX (we've tried). While they say
they will accept PDF they made us convert PDF to Word in the past. I
was able to do this reasonably well with a third-party software tool.

\bigskip
There is an svn repository set up at
\url{https://hedgehog.fhcrc.org/gentleman/bioconductor/trunk/madman/Rpacks/flowCore/paper}
which is also the repository for the flowCore source code. All
contributors should already have usernames and passwords, if not
please contact FH.

\bigskip
There have been discussions on how much technical detail we want to
provide and how and where example should be given:

{\bf PH:} Do we have a simple illustration of why we need to be able to
program with flow data in order to do more meaningful science? Could
we say something about finding populations or automated gating as
being enabled by flowCore?  We have found the lattice plots and the
ability to make overlays very helpful. Could we include an example
where these capabilities would be helpful?

{\bf RB:} Enabling automated gating is certainly true as we have just had a
manuscript accepted for automated gating that relies on flowCore.

{\bf PH:} It seems to me some examples of what flowCore makes possible needs
to be at the heart of the paper. That doesn't mean that we need to
show a detailed analysis.

{\bf ES:} I also think that use cases/examples are very important for selling
the software.  I don't believe we need a complete analysis vignette in
the paper, but specific examples that I've found useful include
\begin{itemize}
\item Correcting for the effects of cell size on autofluoresence using
  Florian's regression,
\item Automating report generation (using Sweave), including making
  overlay plots (supposed hard to batch this job in FlowJo?),
\item automated gating,
\item population finding (using mclust, other R density tools, etc).
\end{itemize}

{\bf RB:} The code examples in the supplementary material, but could
be highlighted in the main text with the pretty results (the selling
point to biologists), something like: “For example, with a short
section of user-configurable code (see Supplementary Material) it is
possible to automate the processing of 1000s of individual FCS data
files and generate high quality reports (Figures 1, 2) including such
steps as quality checking plots, correcting for cell size on auto
fluorescence, followed by automated gating.  This code can be freely
extended and modified by users as the underlying code is all available
at no cost under an open source license ”.  I think it’s important
to remember the audience. The people reading Cytometry we need to
convince on the importance of flowCore are the biologists, and putting
code examples in the main text won’t help, and will likely
hinder. The programmers/statisticians/bioinformaticians out there will
go to the code in the Supplementary Material/Vignettes section
already. All the biologists need to see are the pretty pictures that
let them interpret their data. Highlighting the support network
available (Bioconductor list) will be important in terms of hand
holding.  In terms of making biologists happy, it might be worth
talking to Adam about plans to call R from FlowJo. At the least it
should be highlighted that this is possible in the generic sense.

{\bf PH:} agree that the code examples should go in the supplemental
materials, and I like the examples that Ryan gives below. One thing
that we have found to be very challenging to the biologists is that
they no longer do the primary analysis of their data. We have
addressed that by highlighting the ability to programmatically analyze
lots of data, most of which has fairly straightforward results and
then to focus the biologists attention only on the data that needs
expert interpretation/tweaking.

{\bf BE:} This is, unfortunately, somewhat of a problem---the biologist (as
a community, I realize that there are specific individuals to whom
this does not apply and that I'm likely especially sensitive to this
phenomenon) doesn't believe that data can be analyzed apart from
direct inspection. It might be worth stressing that flow* allows for
not only automated analysis, but provides a platform for improving
collaboration. Actually, it occurs to me that this is probably "the
important bit" for the data structures, which are not particularly
profound in and of themselves---they mostly take the form they do
because that's the way Bioconductor does things in general. However,
what they buy you is a standard mechanism for the organization of
annotation of experiments that is suitable for programmatic
manipulation rather than the usual ad hoc collection of 30 randomly
formatted Excel spreadsheets that may or may not have anything to do
with the actual flow data you have.

{\bf PH:} I agree with that. We need to explain to the biologists that they
"can't get there from here" unless they adopt better data organization
and automated analysis and work collaboratively. It would be nice to
think about how we would make that argument.

\bigskip
FH put the following very rough structure up for discussion:

\section{Introduction}

%%\subsection{High throughput flow}
A brief introduction to the flow technology and high throughput flow
in particular.
{\bf RB:} Given the proposed journal, an introduction to flow technology isn't
required.

\textit{introduction or abstract (first draft)}

Traditionally, flow cytometry has been a tube-based technique limited
to small-scale laboratory and clinical studies.  High throughput
methods for flow cytometry have recently been developed and are now
used in both basic and clinical research. Today, the need for flexible
and well structured computatioonal tools to efficiently handle and
analyze FC-HCS has considerably increased. Indeed, the amount of
information generated by these technology must be stored, managed, and
needs to be summarized in order to be accessible to the
researcher. However, the absence of any shared research platform which
bioinformaticians, computer scientists, and statisticians can use to
develop standard or novel methods for flow cytometric has become
problematic. We believe that the Open Source statistical software R in
conjuction with the Bioconductor Project can fill this gap.  In this
paper, we propose R data structures to handle flow cytometry data
through the main steps of importing, storing, assessing and
preprocessing data from FCM experiments. These methods, along with a
number of specialized functions for compensation, transformation and
filtering and other preprocessing steps, are implemented in the newly
developped Bioconductor package flowCore.  We envision flowCore to be
a solid foundation for researchers to efficiently handle FC-HCS data
and for future development of new methods and tools for the analysis
of flow cytometry.

\textit{end --- introduction (first draft)}

\subsection{R and Bioconductor}

\textit{ example text}

R is a solid statistical framework/environment, particularly geared
towards the analysis the large numeric datasets like those arising
from high throughput experiments such as FC-HCS. Indeed, this open
source software already offers a wide range of statistical and
visualization methods developed for various field of application, many
of them relevant also to FC-HCS data analysis. 
%% FIXME: either cite some of our paper or drop this sentence. 
%% I think it it too redundant with the one above it.
In addition, R is a research platform which
bioinformaticians, computer scientists, and statisticians are using to
develop new tools for statistical data analyis. For biological
application, the Bioconductor project has become the standard toolset
\citep{gentleman2006bos}...  

NLM: reference to microarray ?
\textit{end--- example text}

\subsection{Existing data standards and conventions}

\textit{ example text}

How does the flow data world look like FCS Other flow software (what
other software are handling multiple FCS files all together
). Somebody more familiar with flowJo and friends should add to
this...

FCS -> we can read these files

\textit{end --- example text}

{\bf RB:}  It would be important to highlight
the differences between flowCore and commercial software packages,
including in philosophy (open vs. closed source) and interaction
(programmatic data analysis vs. GUI-driven). 

{\bf PH:} I think the Frame/Set concept is pretty interesting and
powerful. Was it originated for this project? The ability to program
sets flowCore aside from all other flow software applications, I
think. I think there is something really important and valuable about
how the data structures are ogranized. I'm not sure how to write that
in a way to appeal to Cytometry A readers, but I think we could work
this out. Second, I think we have to consider what would be the
motiviation for 
\begin{itemize}
\item why the journal would publish the paper 
\item why someone would read the paper, and
\item why someone would want to try the software
\end{itemize}

\section{Basic data structures}

\textit{example Text}

\Rpackage{flowCore}'s primary task is the representation and basic
manipulation of flow cytometry (or similar) data. This is accomplished
through a data model very similar to that adopted by other
Bioconductor packages used for gene expression analysis and thus
familiar to most Bioconductor users \cite{}.  The data structure is
designed to combine several differents sources of information into a
single convenient structure: (\textit{e.g.,} measurements from a
combination of samples, metadata describing samples in the
experiments).

What are the parts we need to keep together

flowCore does the maintenance, the user doesn't have to care about
that

The concept of sets

Figure: A diagram of the data structures 

\textit{end Text}


{\bf BE:} For this section I think we'd want to describe the philosophy that
underlies the data structure rather than a technical description of
the data structure since they weren't chosen arbitrarily. Like any
other flow tool we start with a collection of events, a flowFrame.
However, we would like to do tasks consistently across several frames
so we introduce a flowSet (a set because there is generally no
inherent ordering) that manages the consistent application of
operations and so on.

\subsection{demands on flow data structures}


numeric raw data matrices
instrument-specific meta data
experiment meta data
memory issues, scale of data (tubes, plates)

\subsection{flowFrame}

\textit{example Text} 

The basic unit of manipulation in \Rpackage{flowCore} is the
\Rclass{flowFrame}, which corresponds roughly with a single ``FCS''
file exported from the flow cytometer's acquisition software. The
\Robject{flowFrame} object store the event-level information along
with a number of additional metadata. The event information, stored as a
single matrix, is easily accessed and manipulated (see
\textit{Supplementary Materials}). All available information regarding
detectors and stains is drawn from the FCS files and attached to the frame.

\textit{end Text}

{\bf NLM:} Should be more abstract ? 



\subsection{flowSet} 
experiments, multiple FCS files, plates


\section{Standard flow operations}
{\bf BE:} We would also like to abstractly describe these operations. This is
somewhat more difficult, especially since we'd like other packages to
be able to extend these operations and introduce their own as
first-class citizens in the analysis. Additionally, we would like to
factor out as much bookkeeping as possible to allow authors to focus
on the actual operation rather than interfacing with flowSets versus
flowFrames and so on. We can then describe the general classes of
operations and how they interact.

\subsection{transformations}
Different flavors, R's own transformation infrastructure allows for
arbitrary transforms, we have implemented the commonly used one.

\subsection{gating}
gate definitions
capturing gating schemes, workflow
gate summary statistics


\section{Application, Outlook}
Challenges in high throughput cytometry
(QA, automated gating, class discovery) 

flowCore as toolbox

already in devel 'plug-in' packages (Visualization, QA, stats, ...)

\bibliographystyle{plainnat}  
\bibliography{flowCoreRef} 
\end{document}

